# This script automates the Malware Removal process by using Malwarebytes Breach Remediation

# Variables
key='ENTER_KEY_HERE'
mbbr='/usr/local/bin/com.malwarebytes.mbbr.tool'

# File Info
url='https://data-cdn.mbamupdates.com/web/mbbr_mac/MBBR-Mac-4.17.8.282.pkg'
file='MBBR-Mac-4.17.8.282.pkg'

# Inform user of download
message='Downloading Malwarebytes Breach Remediation'
echo -e "\n$(tput setaf 2)$message$(tput sgr0)\n"

# Download Malwarebytes to the tmp directory
cd /tmp
curl -O $url

# Install Malwarebytes Breach Remediation
message='Enter the administrator password below. If the admin password is blank, then this will not work'
echo -e "\n$(tput setaf 2)$message$(tput sgr0)\n"
sudo installer -pkg $file -target /

# Prompt user to allow Full Disk Access
message='Please provide Full Disk Access to Malwarebytes Protection in System Settings. The Privacy and Security window will open in 5 seconds'
echo -e "\n$(tput setaf 2)$message$(tput sgr0)\n"
sleep 3
open "x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"
message='Have you provided Full Disk Access? (Y/N): '
while true; do
    read -p "$(tput setaf 2)$message$(tput sgr0)" yn
    case $yn in
        [Yy]* ) break;;
        [Nn]* ) exit;;
        * ) echo "Please answer Y or N.";;
    esac
done

# Run a scan with Malwarebytes Breach Remediation
sudo $mbbr license activate-key $key
sudo $mbbr update
sudo $mbbr scan --remove --no-reboot

# Deactivate and uninstall Malwarebytes Breach Remendiation
sudo $mbbr license deactivate
sudo $mbbr uninstall